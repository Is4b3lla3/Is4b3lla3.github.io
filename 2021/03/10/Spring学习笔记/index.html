<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Spring"><meta name="keywords" content="Java"><meta name="author" content="Isabellae"><meta name="copyright" content="Isabellae"><title>Spring学习笔记 | Isabellae's Blog</title><link rel="shortcut icon" href="/terminal_emulator.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#spring结构"><span class="toc-number">1.</span> <span class="toc-text">spring结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三层架构"><span class="toc-number">2.</span> <span class="toc-text">三层架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#三层与MVC的区别"><span class="toc-number">2.1.</span> <span class="toc-text">三层与MVC的区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#程序之间的耦合"><span class="toc-number">3.</span> <span class="toc-text">程序之间的耦合</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#耦合"><span class="toc-number">3.1.</span> <span class="toc-text">耦合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解耦"><span class="toc-number">3.2.</span> <span class="toc-text">解耦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#解耦的思路"><span class="toc-number">3.3.</span> <span class="toc-text">解耦的思路</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ioc-控制反转"><span class="toc-number">4.</span> <span class="toc-text">ioc 控制反转</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#spring中的ioc以及两个接口区别"><span class="toc-number">4.1.</span> <span class="toc-text">spring中的ioc以及两个接口区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三种创建bean的方式"><span class="toc-number">4.2.</span> <span class="toc-text">三种创建bean的方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bean的作用范围"><span class="toc-number">4.3.</span> <span class="toc-text">bean的作用范围</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bean对象的生命周期"><span class="toc-number">4.4.</span> <span class="toc-text">bean对象的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单例"><span class="toc-number">4.4.1.</span> <span class="toc-text">单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多例"><span class="toc-number">4.4.2.</span> <span class="toc-text">多例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring依赖注入"><span class="toc-number">5.</span> <span class="toc-text">Spring依赖注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#注入的方式有三种"><span class="toc-number">5.1.</span> <span class="toc-text">注入的方式有三种</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring中ioc的常用注解"><span class="toc-number">6.</span> <span class="toc-text">Spring中ioc的常用注解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用于创建对象"><span class="toc-number">6.1.</span> <span class="toc-text">用于创建对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Component"><span class="toc-number">6.1.1.</span> <span class="toc-text">Component:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Controller：一般用于表现层"><span class="toc-number">6.1.2.</span> <span class="toc-text">Controller：一般用于表现层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Service：一般用于业务层"><span class="toc-number">6.1.3.</span> <span class="toc-text">Service：一般用于业务层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Repository：一般用于持久层"><span class="toc-number">6.1.4.</span> <span class="toc-text">Repository：一般用于持久层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用于注入数据"><span class="toc-number">6.2.</span> <span class="toc-text">用于注入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AutoWired"><span class="toc-number">6.2.1.</span> <span class="toc-text">AutoWired</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Qualifier"><span class="toc-number">6.2.2.</span> <span class="toc-text">Qualifier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resource"><span class="toc-number">6.2.3.</span> <span class="toc-text">Resource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Value"><span class="toc-number">6.2.4.</span> <span class="toc-text">Value</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用于改变范围"><span class="toc-number">6.3.</span> <span class="toc-text">用于改变范围</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Socope"><span class="toc-number">6.3.1.</span> <span class="toc-text">Socope</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用于生命周期相关"><span class="toc-number">6.4.</span> <span class="toc-text">用于生命周期相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PreDestroy"><span class="toc-number">6.4.1.</span> <span class="toc-text">PreDestroy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PostConstruct"><span class="toc-number">6.4.2.</span> <span class="toc-text">PostConstruct</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AnnotationConfigApplicationContext的使用"><span class="toc-number">7.</span> <span class="toc-text">AnnotationConfigApplicationContext的使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置类，等效于bean-xml"><span class="toc-number">8.</span> <span class="toc-text">配置类，等效于bean.xml</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration"><span class="toc-number">8.1.</span> <span class="toc-text">Configuration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ComponentScan"><span class="toc-number">8.2.</span> <span class="toc-text">ComponentScan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean"><span class="toc-number">8.3.</span> <span class="toc-text">Bean</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Import"><span class="toc-number">8.4.</span> <span class="toc-text">Import</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PropertySource"><span class="toc-number">8.5.</span> <span class="toc-text">PropertySource</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Junit"><span class="toc-number">9.</span> <span class="toc-text">Junit</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring整合Junit配置"><span class="toc-number">9.1.</span> <span class="toc-text">Spring整合Junit配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ContextConfiguration（-告知Spring的运行器，spring的ioc创建是基于xml还是注解，并说明位置）"><span class="toc-number">9.1.1.</span> <span class="toc-text">ContextConfiguration（ 告知Spring的运行器，spring的ioc创建是基于xml还是注解，并说明位置）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#事务的一致性"><span class="toc-number">10.</span> <span class="toc-text">事务的一致性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动态代理"><span class="toc-number">11.</span> <span class="toc-text">动态代理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基于接口的动态代理"><span class="toc-number">11.1.</span> <span class="toc-text">基于接口的动态代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基于子类的动态代理"><span class="toc-number">11.2.</span> <span class="toc-text">基于子类的动态代理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOP"><span class="toc-number">12.</span> <span class="toc-text">AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP相关术语"><span class="toc-number">12.1.</span> <span class="toc-text">AOP相关术语</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring基于AOP配置步骤"><span class="toc-number">12.2.</span> <span class="toc-text">Spring基于AOP配置步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通知类型"><span class="toc-number">12.3.</span> <span class="toc-text">通知类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring中的环绕通知"><span class="toc-number">12.3.1.</span> <span class="toc-text">Spring中的环绕通知</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JDBCTemplate"><span class="toc-number">13.</span> <span class="toc-text">JDBCTemplate</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/IMG_20190204_224358.jpg"></div><div class="author-info__name text-center">Isabellae</div><div class="author-info__description text-center">Cyber Security</div><div class="follow-button"><a href="https://github.com/is4b3lla3" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">10</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">6</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">6</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" href="http://www.y1nhui.com/" target="_blank" rel="noopener">y1nhui</a><a class="author-info-links__name text-center" href="http://www.adminxt.com/" target="_blank" rel="noopener">adminxt</a><a class="author-info-links__name text-center" href="https://www.zhaosimeng.cn/" target="_blank" rel="noopener">守卫者安全</a><a class="author-info-links__name text-center" href="https://v0w.top/" target="_blank" rel="noopener">v0wkeep3r</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/2700d379fda645e77d754fc4956024c6.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Isabellae's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/links">links</a><a class="site-page" href="/about">About</a></span></div><div id="post-info"><div id="post-title">Spring学习笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-03-09</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>is4b3lla3’s notes</p>
<a id="more"></a>

<h1 id="spring结构"><a href="#spring结构" class="headerlink" title="spring结构"></a>spring结构</h1><p><img src="./springframework.png" alt="spirng"></p>
<h1 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h1><p>表现层调用业务层<br>业务层调用持久层</p>
<ul>
<li><p>表现层（JSP）：<br>表现层也称为界面层，位于最外层（最上层），离用户最近。用于显示数据和接收用户输入的数据，为用户提供一种交互式操作的界面</p>
</li>
<li><p>业务层（逻辑层、service层）：<br>业务层（Business Logic Layer）无疑是系统架构中体现核心价值的部分。它的关注点主要集中在业务规则的制定、业务流程的实现等与业务需求有关的系统设计，也即是说它是与系统所应对的领域（Domain）逻辑有关，很多时候，也将业务逻辑层称为领域层。</p>
</li>
<li><p>持久层（DAO）：<br>持久层，有时候也称为是数据访问层，其功能主要是负责数据库的访问，可以访问数据库系统、二进制文件、文本文档或是XML文档。采用DAO模式，建立实体类和数据库表映射（ORM映射）。简单的说法就是实现对数据表的select、insert、update以及delete的操作。如果要加入ORM的元素，那么就会包括对象和数据表之间的mapping，以及对象实体的持久化。</p>
</li>
</ul>
<h2 id="三层与MVC的区别"><a href="#三层与MVC的区别" class="headerlink" title="三层与MVC的区别"></a>三层与MVC的区别</h2><p>三层与MVC的最不同的地方在于<strong>三层是没有Controller控制器的概念</strong>。虽然同样是架构级别的，三层与MVC相同的地方在于<strong>他们都有一个表现层（view）</strong>，但是他们不同的地方在于其他的两个层。<strong>MVC没有把业务的逻辑访问看成两个层</strong>，这是采用三层架构或MVC搭建程序最主要的区别。当然了，在三层中也提到了Model概念，但是三层架构中Model的概念与MVC中Model的概念是不一样的，“三层” 中典型的Model层是以实体类构成的，而MVC里，则是由业务逻辑与访问数据组成的。</p>
<p>在三层中JSP与Servlet代码都属于表示层，业务逻辑层则是完成业务规则的实体类，数据访问层则是JDBC等代码<br>MVC中：model：Java bean； view：jsp；controller：servlet</p>
<h1 id="程序之间的耦合"><a href="#程序之间的耦合" class="headerlink" title="程序之间的耦合"></a>程序之间的耦合</h1><h2 id="耦合"><a href="#耦合" class="headerlink" title="耦合"></a>耦合</h2><p>程序之间的依赖关系</p>
<ol>
<li>类之间的依赖</li>
<li>方法之间的依赖</li>
</ol>
<h2 id="解耦"><a href="#解耦" class="headerlink" title="解耦"></a>解耦</h2><p>降低程序之间的依赖关系</p>
<ul>
<li>实际开发中：<br>编译期不依赖，运行时才依赖<br>编译期的依赖导致该类独立性很差</li>
</ul>
<p>例子：<br>jdbc两种注册方式：</p>
<ol>
<li><code>Class.forName(&quot;com.mysql.jdbc.Driver()&quot;)</code>  编译时不依赖，运行依赖，检查jar包，没有jar包抛出<code>异常</code></li>
<li><code>DriverManager.registerDriver(new com.mysql.jdbc.Driver());</code> 编译时依赖，检查jar包，没有jar包<code>编译失败</code></li>
</ol>
<h2 id="解耦的思路"><a href="#解耦的思路" class="headerlink" title="解耦的思路"></a>解耦的思路</h2><ol>
<li>创建对象时候使用反射，而避免<code>new</code>关键字</li>
<li>通过读取配置文件，来获取要创建的对象全限定类名</li>
</ol>
<ul>
<li>Bean：计算机英语中：可重用组件的含义</li>
<li>java bean（Java编写的可重用组件） &gt; 实体类</li>
</ul>
<ol>
<li>配置文件来配置类<br> 配置的内容：唯一标识：全限定类名<br> （key=&gt;value）</li>
<li>读取配置文件内容，<strong>反射创建对象</strong></li>
</ol>
<p>配置文件可以是xml也可以是properties</p>
<ul>
<li>static｛｝</li>
</ul>
<p>称为static代码块 ,也叫静态代码块，</p>
<p>是在类中独立于类成员的static语句块，可以有多个，位置可以随便放，它不在任何的方法体内，JVM加载类时会执行这些静态的代码块，如果static代码块有多个，JVM将按照它们在类中出现的先后顺序依次执行它们，每个代码块只会被执行一次<br>利用静态代码块可以对一些static变量进行赋值<br><strong>静态代码块只在类加载是执行一次</strong></p>
<h1 id="ioc-控制反转"><a href="#ioc-控制反转" class="headerlink" title="ioc 控制反转"></a>ioc 控制反转</h1><p><img src="./ioc.png" alt="ioc"></p>
<blockquote>
<p>控制权转移<br>把创建对象的权利交给框架，是框架的的重要特征，并非面向对象的专用术语。它包括依赖注入和依赖查找<br>ioc作用：消减计算机程序的耦合。（解除代码依赖关系）</p>
</blockquote>
<h2 id="spring中的ioc以及两个接口区别"><a href="#spring中的ioc以及两个接口区别" class="headerlink" title="spring中的ioc以及两个接口区别"></a>spring中的ioc以及两个接口区别</h2><ul>
<li>Spring中的IOC容器是Map结构</li>
</ul>
<table>
<thead>
<tr>
<th>key String类型</th>
<th>value Object类型</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>2</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取spring的IOC核心容器，并根据ID获取对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ApplicationContext的3个常用实现类</span></span><br><span class="line"><span class="comment">     * ClassPathXmlApplicationContext：加载类路径下的配置文件，要求配置文件必须在类路径下。</span></span><br><span class="line"><span class="comment">     * FileSystemXmlApplicationContext：加载磁盘任意路径下的配置文件（必须有访问权限）</span></span><br><span class="line"><span class="comment">     * AnnotationConfigApplicationContext：读取注解创建容器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 核心容器的两个接口引发出的问题</span></span><br><span class="line"><span class="comment">     * ApplicationContext（单例对象适用）：构建核心容器时，创建对象采用的是立即加载。也就是说一读取完配置就马上创建配置文件中配置的对象。</span></span><br><span class="line"><span class="comment">     * BeanFactory（多例对象适用）：构建核心容器时，创建对象采用延迟加载的方式。也就是说什么时候根据ID获取对象，什么时候真正创建对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args main</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1. 获取核心容器对象</span></span><br><span class="line">        ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">        <span class="comment">//2. 根据id获取bean对象</span></span><br><span class="line">        IAccountService as = (IAccountService)ac.getBean(<span class="string">"accountService"</span>);<span class="comment">//Object类型强转</span></span><br><span class="line">        IAccountDao adao = ac.getBean(<span class="string">"accountDao"</span>,IAccountDao.class);<span class="comment">//传给字节码强转</span></span><br><span class="line">        System.out.println(as);</span><br><span class="line">        System.out.println(adao);</span><br><span class="line">        as.saveAccount();</span><br><span class="line">        <span class="comment">//----------BeanFactory</span></span><br><span class="line">        Resource r = <span class="keyword">new</span> ClassPathResource(<span class="string">"bean.xml"</span>);</span><br><span class="line">        BeanFactory factory  = <span class="keyword">new</span> XmlBeanFactory(r);</span><br><span class="line">        IAccountService as1 = (IAccountService)factory.getBean(<span class="string">"accountService"</span>);</span><br><span class="line">        System.out.println(as1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三种创建bean的方式"><a href="#三种创建bean的方式" class="headerlink" title="三种创建bean的方式"></a>三种创建bean的方式</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">&lt;!--把对象的创建交给spring处理--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span> = <span class="string">"com.service.impl.AccountServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    com1  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    spring 对bean的管理细节</span></span><br><span class="line"><span class="comment">            1. 创建bean的三种方式</span></span><br><span class="line"><span class="comment">            2. bean对象的作用范围</span></span><br><span class="line"><span class="comment">            3. bean对象的生命周期</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    三种方式：</span></span><br><span class="line"><span class="comment">            1.在spring的配置文件中使用bean标签，配以id和class属性之后，且没有其他属性和标签，采用的就是默认构造函数创建bean对象。此时</span></span><br><span class="line"><span class="comment">            如果类中没有默认构造函数，则对象无法创建。（默认构造函数创建）--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com_1.service.impl.AccountServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    2.使用普通工厂中的方法创建对象（使用某个类中的方法创建对象，并存入spring容器）</span></span><br><span class="line"><span class="comment">            com_1.factory.InstanceFactory</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"instanceFactory"</span> <span class="attr">class</span>=<span class="string">"com_1.factory.InstanceFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">factory-bean</span>=<span class="string">"instanceFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    3.使用静态工厂中的静态方法创建对象（使用某个类中的静态方法创建对象，并存入Spring容器）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com_1.factory.StaticFactory"</span> <span class="attr">factory-method</span>=<span class="string">"getAccountService"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="bean的作用范围"><a href="#bean的作用范围" class="headerlink" title="bean的作用范围"></a>bean的作用范围</h2><p>Spring的bean对象默认是单例的。</p>
<ul>
<li>bean的作用范围调整：<br>标签里的scope属性：用于指定bean的作用范围</li>
<li>取值：<ul>
<li>singleton：单例（默认值）</li>
<li>prototype：多例</li>
<li>request：作用于Web应用的请求范围</li>
<li>session：作用于Web应用的会话范围</li>
<li>global-session：作用于集群环境的会话范围（全局会话范围）。当不是集群环境是，它等于session</li>
</ul>
</li>
</ul>
<h2 id="bean对象的生命周期"><a href="#bean对象的生命周期" class="headerlink" title="bean对象的生命周期"></a>bean对象的生命周期</h2><p>init-method：初始化方法<br>destroy-method：销毁方法</p>
<h3 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h3><ul>
<li>当容器创建时对象出生（立即创建）</li>
<li>只要容器存在，对象一直存在</li>
<li>容器销毁，对象销毁<br>（单例对象生命周期和容器相同）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">IAccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AccountServiceImpl</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"instantiate successfully"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"saveAccount of service has exec"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"初始化"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"销毁"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Client.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args main</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1. 获取核心容器对象</span></span><br><span class="line">        <span class="comment">//ApplicationContext ac = new ClassPathXmlApplicationContext("bean.xml");</span></span><br><span class="line">        ClassPathXmlApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line">        <span class="comment">//2. 根据id获取bean对象</span></span><br><span class="line">        com_1.service.IAccountService as = (com_1.service.IAccountService)ac.getBean(<span class="string">"accountService"</span>);<span class="comment">//Object类型强转</span></span><br><span class="line"></span><br><span class="line">        System.out.println(as);</span><br><span class="line">        as.saveAccount();</span><br><span class="line">        <span class="comment">//手动关闭容器</span></span><br><span class="line">        ac.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//bean.xml</span></span><br><span class="line"><span class="comment">// &lt;bean id="accountService" class="com_1.service.impl.AccountServiceImpl"</span></span><br><span class="line"><span class="comment">//       scope="singleton" init-method="init" destroy-method="destory"&gt;&lt;/bean&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="多例"><a href="#多例" class="headerlink" title="多例"></a>多例</h3><p>当我们使用对象时Spring框架为我们创建（延迟创建）<br>对象在使用过程中一直存活<br>当对象长时间不用且没有别的对象引用时，Java的GC自动回收</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com_1.service.impl.AccountServiceImpl"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">scope</span>=<span class="string">"prototype"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"destory"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h1 id="Spring依赖注入"><a href="#Spring依赖注入" class="headerlink" title="Spring依赖注入"></a>Spring依赖注入</h1><ul>
<li><p>Dependency Injection</p>
</li>
<li><p>IOC作用：消除程序间的耦合（依赖关系）</p>
</li>
<li><p>依赖关系的管理交给Spring维护<br>在当前类需要用到其它类的对象，由Spring来提供，我们只需要在配置文件中说明。</p>
</li>
<li><p>依赖关系的维护：依赖注入</p>
</li>
<li><p>依赖注入的数据有三类：</p>
<ol>
<li>基本类型和String</li>
<li>其他bean类型。（在配置文件中或者注解配置过的bean）</li>
<li>复杂类型/集合类型</li>
</ol>
</li>
</ul>
<h2 id="注入的方式有三种"><a href="#注入的方式有三种" class="headerlink" title="注入的方式有三种"></a>注入的方式有三种</h2><ol>
<li>构造函数提供<br>构造函数注入</li>
</ol>
<ul>
<li>使用constructor-arg</li>
<li>标签出现的位置：bean标签内部</li>
<li>标签中的属性：<ul>
<li>type 指定要注入的数据类型，该数据类型也是构造函数中某些参数的类型</li>
<li>index 指定注入数据的索引（从0开始）</li>
<li>name 指定名称的参数赋值<blockquote>
<p>以上三个指定构造函数中参数来赋值</p>
</blockquote>
</li>
<li>value 提供基本类型和String类型数据</li>
<li>ref 指定其他Bean类型，引用（它指Spring的Ioc核心容器中的bean对象）</li>
<li>特点：获取Bean对象时，注入数据是必须操作，否则无法操作成功<pre><code>改变了Bean对象的实例化方式。使我们创建对象时，用不到的数据也会提供</code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span> = <span class="string">"com_1.service.impl.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"test"</span> &gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--   xml中存储都是字符串，这里自动转成Integer     --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"18"</span> &gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        配置一个日期对象    --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">"java.util.Date"</span> <span class="attr">name</span>=<span class="string">"brithday"</span> <span class="attr">ref</span>=<span class="string">"now"</span> &gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    日期对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"now"</span> <span class="attr">class</span>=<span class="string">"java.util.Date"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>set方法提供</li>
</ol>
<ul>
<li><p>set方法注入</p>
<ul>
<li><p>涉及的标签:<code>property</code></p>
</li>
<li><p>出现位置:bean标签内部</p>
</li>
<li><p>标签的属性:</p>
<ul>
<li>name指定注入时set方法名称</li>
<li>value提供基本类型和String类型数据</li>
<li>ref指定其他Bean类型，引用（它指Spring的Ioc核心容器中的bean对象）</li>
</ul>
</li>
<li><p>优势:创建对象时没有明确限制,可以使用默认构造函数</p>
</li>
<li><p>缺点:若某个成员变量必须有值,则获取对象时set方法可能没有执行</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService2"</span> <span class="attr">class</span>=<span class="string">"com_1.service.impl.AccountServiceImpl2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"21"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"brithday"</span> <span class="attr">ref</span>=<span class="string">"now"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>注解提供<br>复杂类型注入/集合类型注入(set方法)<br> 用于给List结构集合注入的标签有List,Array和Set<br> 用于给Map结构集合注入的标签有Map和Props<br> <strong>结构相同,标签可以互换</strong><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService3"</span> <span class="attr">class</span>=<span class="string">"com_1.service.impl.AccountServiceImpl3"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myStrs"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>ABC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Y65<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>JK1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>###<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>$$$<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>^^^<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mySet"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>ABC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>Y65<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>JK1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myMap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"admin"</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"username1"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>admin1<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"myProps"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"key"</span>&gt;</span>value<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"key1"</span>&gt;</span>value1<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="Spring中ioc的常用注解"><a href="#Spring中ioc的常用注解" class="headerlink" title="Spring中ioc的常用注解"></a>Spring中ioc的常用注解</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    告知Spring在创建容器时要扫描的包，配置所需要的标签不是在&lt;beans&gt;约束中，而是在context名称空间和约束中    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>曾经的xml配置<ul>
<li><code>&lt;bean id=&quot;accountService&quot; class = &quot;com.service.impl.AccountServiceImpl&quot;&gt;&lt;/bean&gt;</code></li>
</ul>
</li>
</ul>
<h2 id="用于创建对象"><a href="#用于创建对象" class="headerlink" title="用于创建对象"></a>用于创建对象</h2><p>作用和xml配置文件中写bean标签实现功能一样</p>
<h3 id="Component"><a href="#Component" class="headerlink" title="Component:"></a>Component:</h3><ul>
<li>出现位置：类</li>
<li>作用：用于把当前类对象存入Spring容器中</li>
<li>属性：<ul>
<li>value：用于指定bean的id，当不写时，默认值是当前类名，首字母小写</li>
</ul>
</li>
</ul>
<h3 id="Controller：一般用于表现层"><a href="#Controller：一般用于表现层" class="headerlink" title="Controller：一般用于表现层"></a>Controller：一般用于表现层</h3><h3 id="Service：一般用于业务层"><a href="#Service：一般用于业务层" class="headerlink" title="Service：一般用于业务层"></a>Service：一般用于业务层</h3><h3 id="Repository：一般用于持久层"><a href="#Repository：一般用于持久层" class="headerlink" title="Repository：一般用于持久层"></a>Repository：一般用于持久层</h3><p>以上3个注解的作用和属性和Component一样。这三个注解是Spring框架提供的明确的三层使用的注解，使我们三层对象更加清晰。不属于这三层的对象用Component</p>
<h2 id="用于注入数据"><a href="#用于注入数据" class="headerlink" title="用于注入数据"></a>用于注入数据</h2><p>作用和xml配置文件中的bean标签中的property标签一样</p>
<h3 id="AutoWired"><a href="#AutoWired" class="headerlink" title="AutoWired"></a>AutoWired</h3><ul>
<li>作用：自动按照类型注入。只要容器中有唯一的一个bean对象类型和要注入的变量类型匹配，就可以注入成功。<br>如果没有任何bean的类型和要注入类型变量匹配，则报错。如果容器中有多个bean对象类型，出现位置：可以是变量，也可以是方法（在使用注解时，set方法不是必须的）<h3 id="Qualifier"><a href="#Qualifier" class="headerlink" title="Qualifier"></a>Qualifier</h3></li>
<li>作用：再按照类型注入的基础之上再按照名称注入，他在给类成员注入时不能单独使用（和AutoWired配合使用），但是在给方法参数注入时可以</li>
<li>属性：<ul>
<li>value：用于指定注入bean的ID<h3 id="Resource"><a href="#Resource" class="headerlink" title="Resource"></a>Resource</h3></li>
</ul>
</li>
<li>作用：直接按照bean的ID注入，可以独立使用。</li>
<li>属性：<ul>
<li>name：用于指定bean的ID</li>
</ul>
</li>
</ul>
<blockquote>
<p>以上3个注解都只能注入其他bean类型数据，而基本类型和String类型无法使用。集合数据类型只能通过XML来实现</p>
</blockquote>
<hr>
<h3 id="Value"><a href="#Value" class="headerlink" title="Value"></a>Value</h3><ul>
<li>作用：用于注入String和基本类型数据</li>
<li>属性：<ul>
<li>value：用于指定数据的值。它可以使用Spring中的SpEL（Spring的el表达式）<ul>
<li>SpEL的写法：${表达式}</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="用于改变范围"><a href="#用于改变范围" class="headerlink" title="用于改变范围"></a>用于改变范围</h2><p>作用和xml配置文件中的bean标签中的scope属性一样</p>
<h3 id="Socope"><a href="#Socope" class="headerlink" title="Socope"></a>Socope</h3><ul>
<li>作用：用于指定bean的作用范围</li>
<li>属性：<ul>
<li>value：指定范围的取值。常用取值：singleton，prototype。（不写默认单例）</li>
</ul>
</li>
</ul>
<h2 id="用于生命周期相关"><a href="#用于生命周期相关" class="headerlink" title="用于生命周期相关"></a>用于生命周期相关</h2><p>作用和xml配置文件中的bean标签中的init_method，destroy-method属性一样</p>
<h3 id="PreDestroy"><a href="#PreDestroy" class="headerlink" title="PreDestroy"></a>PreDestroy</h3><p>作用：用于指定销毁方法</p>
<h3 id="PostConstruct"><a href="#PostConstruct" class="headerlink" title="PostConstruct"></a>PostConstruct</h3><p>作用：用于指定初始化方法</p>
<ul>
<li>bean.xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    创建容器时，要扫描的包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        QueryRunner对象</span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"runner"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbutils.QueryRunner"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            注入数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"ds"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    配置数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--        连接数据库的必备信息--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/zcs"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"0903"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="AnnotationConfigApplicationContext的使用"><a href="#AnnotationConfigApplicationContext的使用" class="headerlink" title="AnnotationConfigApplicationContext的使用"></a>AnnotationConfigApplicationContext的使用</h1><p>之前的实现都是使用如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.获取容器</span></span><br><span class="line">ApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"bean.xml"</span>);</span><br><span class="line"><span class="comment">//2.得到业务层对象</span></span><br><span class="line">IAccountService as = ac.getBean(<span class="string">"accountService"</span>, IAccountService.class);</span><br></pre></td></tr></table></figure>
<p><code>ClassPathXmlApplicationContext</code>类：加载类路径下的配置文件，要求配置文件必须在类路径下。</p>
<ul>
<li><p>使用<code>AnnotationConfigApplicationContext</code>类来通过读取注解创建容器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.获取容器</span></span><br><span class="line"><span class="comment">//参数为：一个或多个带注解的类，如果参数写了某个注解类，则不扫描该包也可以在容器中创建对象</span></span><br><span class="line">ApplicationContext ac = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfiguration.class);</span><br><span class="line"><span class="comment">//2.得到业务层对象</span></span><br><span class="line">IAccountService as = ac.getBean(<span class="string">"accountService"</span>, IAccountService.class);</span><br></pre></td></tr></table></figure></li>
<li><p>SpringConfiguration</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>(basePackages = <span class="string">"com"</span>)</span><br><span class="line"><span class="meta">@Import</span>(value =JdbcConfig.class)</span><br><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:JdbcConfig.properties"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>JdbcConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;Driver&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String Driver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;Url&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String Url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;User&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String User;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;Password&#125;"</span>)</span><br><span class="line">    <span class="keyword">private</span> String Password;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建QueryRunner对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ds</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"runner"</span>)</span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"prototype"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> QueryRunner <span class="title">createQueryRunner</span><span class="params">(DataSource ds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> QueryRunner(ds);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建数据源对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"dataSource"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">createDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ComboPooledDataSource cds = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">            cds.setDriverClass(Driver);</span><br><span class="line">            cds.setJdbcUrl(Url);</span><br><span class="line">            cds.setUser(User);</span><br><span class="line">            cds.setPassword(Password);</span><br><span class="line">            <span class="keyword">return</span> cds;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>JdbcConfig.properties</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Driver=com.mysql.jdbc.Driver</span><br><span class="line">Url=jdbc:mysql://localhost:3306/zcs</span><br><span class="line">User=root</span><br><span class="line">Password=xxxx</span><br></pre></td></tr></table></figure>


</li>
</ul>
<p>之前基于XML配置中<code>runner</code>为多例，而现在基于注解配置则为单例。所以要加Scope注解</p>
<h1 id="配置类，等效于bean-xml"><a href="#配置类，等效于bean-xml" class="headerlink" title="配置类，等效于bean.xml"></a>配置类，等效于bean.xml</h1><p>Spring中的新注解</p>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><ul>
<li>作用：指定当前类是配置类</li>
<li>细节：当配置类作为AnnotationConfigApplicationContext对象创建的参数时，该注解可以不写。<pre><code>如果不写该注解，即使使用ComponentScan扫描该包，也不会放到容器里</code></pre></li>
</ul>
<h2 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="ComponentScan"></a>ComponentScan</h2><ul>
<li>作用：用于通过注解指定Spring在创建容器时要扫描的包。（等效于<code>&lt;context:component-scan&gt;</code>）</li>
<li>属性： value和basePackages相同，都是用于指定创建容器时要扫描的包</li>
</ul>
<h2 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h2><ul>
<li>作用：用于把当前方法的返回值作为Bean对象存入Spring的IOC容器中。</li>
<li>属性：name：指定Bean的id，不写的默认值是当前方法名称</li>
<li>细节：使用注解配置方法时，如果方法有参数，Spring框架会查找容器中有无可用的Bean对象。查找方式和AutoWired一样。</li>
</ul>
<h2 id="Import"><a href="#Import" class="headerlink" title="Import"></a>Import</h2><ul>
<li>作用：用于导入其他的配置类<pre><code>import(&quot;xxx.class&quot;)
例如在一个主配置类处添加import注解导入其他一个或多个子配置类</code></pre></li>
<li>属性：value：用于指定其他配置类的字节码。当我们使用import类的为父配置类，导入的类为子配置</li>
</ul>
<h2 id="PropertySource"><a href="#PropertySource" class="headerlink" title="PropertySource"></a>PropertySource</h2><ul>
<li>作用：用于指定Properties文件的位置</li>
<li>属性：<pre><code>value:指定文件名称和路径,(classpath:xxx/xxx.properties，classpath表示类路径下)</code></pre></li>
</ul>
<h1 id="Junit"><a href="#Junit" class="headerlink" title="Junit"></a>Junit</h1><p><img src="./junit.png" alt="junit"></p>
<h2 id="Spring整合Junit配置"><a href="#Spring整合Junit配置" class="headerlink" title="Spring整合Junit配置"></a>Spring整合Junit配置</h2><p>使用Junit单元测试，测试配置</p>
<ul>
<li>Spring整合Junit的配置<ol>
<li>导入Spring整合Junit的jar(坐标)</li>
<li>使用Junit提供的注解把原有的main方法替换成Spring提供的<code>@Runwith</code>注解</li>
<li>告知Spring的运行器，spring的ioc创建是基于xml还是注解，并说明位置<h3 id="ContextConfiguration（-告知Spring的运行器，spring的ioc创建是基于xml还是注解，并说明位置）"><a href="#ContextConfiguration（-告知Spring的运行器，spring的ioc创建是基于xml还是注解，并说明位置）" class="headerlink" title="ContextConfiguration（ 告知Spring的运行器，spring的ioc创建是基于xml还是注解，并说明位置）"></a>ContextConfiguration（ 告知Spring的运行器，spring的ioc创建是基于xml还是注解，并说明位置）</h3></li>
</ol>
</li>
<li>属性：<ul>
<li>location：指定xml位置加上classpath关键字，表示在类路径下</li>
<li>classes：指定注解类所在位置<br>当使用Spring5.x版本时，要求Junit版本4.12以上</li>
</ul>
</li>
</ul>
<h1 id="事务的一致性"><a href="#事务的一致性" class="headerlink" title="事务的一致性"></a>事务的一致性</h1><p>需要使用ThreadLocal对象把Connection和当前对象绑定，从而使一个线程中只有一个能控制事务的对象<br><img src="./transfer.png" alt="转账例子"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">findAllAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.开启事务</span></span><br><span class="line">            transactionManager.beginTransaction();</span><br><span class="line">            <span class="comment">//2.执行操作</span></span><br><span class="line">            List&lt;Account&gt; accounts = accountDao.findAllAccount();</span><br><span class="line">            <span class="comment">//3.提交事务</span></span><br><span class="line">            transactionManager.commit();</span><br><span class="line">            <span class="comment">//4.返回结果</span></span><br><span class="line">            <span class="keyword">return</span> accounts;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//5.回滚</span></span><br><span class="line">            transactionManager.rollback();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//6.释放</span></span><br><span class="line">            transactionManager.release();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>catch代码块直接e.printstack()的话，执行完后会往下继续执行，此处抛出异常(throw new RuntimeException(e);)，才能防止代码继续向下执行(return返回对象)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Account&gt; <span class="title">findAllAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> runner.query(connectionUtils.getThreadConnection(),<span class="string">"select * from account"</span>, <span class="keyword">new</span> BeanListHandler&lt;Account&gt;(Account.class));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>connectionUtils.getThreadConnection()</code>作为query()方法第一个参数<blockquote>
<p>connectionUtils类中，set方法注入DataSource。<br>可以通俗理解。Query原先是多例的，如果直接注入，每次都是一个新的bean，相当于多个连接在操作同一个数据库。而事物保证必须是单例，所以使用utils确保拿到的是同一个对象。<br>就是不用spring注入获得的连接，只用工具类创建和线程绑定的连接<br><strong>如果表是MyiSAM是不支持事务的</strong></p>
</blockquote>
</li>
</ul>
<h1 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h1><blockquote>
<p>当匿名内部类访问外部成员变量时候，外部变量要用final修饰（因为局部变量随着方法的调用而调用，随着方法消失而消失，而对内存的内容不会立即消失，还会继续引用局部变量）</p>
</blockquote>
<ul>
<li>动态代理<ul>
<li>特点：字节码随用随创建，随用随加载</li>
<li>作用：不修改源码的基础上，对方法增强</li>
<li>分类：<ul>
<li>基于接口的动态代理<ul>
<li>涉及的类：Proxy</li>
<li>提供者：JDK官方</li>
<li>如何创建代理对象：使用Proxy类中的<code>newProxyInstance()</code>方法</li>
<li>创建代理对象要求：被代理类最少实现一个接口，如果没有不能使用</li>
<li><code>newProxyInstance()</code>方法的参数<ul>
<li>ClassLoader：类加载器<ul>
<li>加载代理对象字节码，和被代理对象使用相同类加载器。固定写法：<code>xx.getClass().getClassLoader()</code></li>
</ul>
</li>
<li>Class[]：字节码数组<ul>
<li>用于让代理对象和被代理对象拥有相同方法。固定写法：<code>xxx.getClass().getInterfaces()</code></li>
</ul>
</li>
<li>InvocationHandler：用于提供增强的代码<ul>
<li>他是让我们写如何代理，我们一般都是写一个该接口的实现类，通常情况下都是匿名内部类但不必须。<ul>
<li>此接口实现类都是谁用谁写</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>基于子类的动态代理<ul>
<li>涉及的类：Enhancer</li>
<li>提供者：第三方cglib库</li>
<li>如何创建代理对象：使用Enhancer类中的<code>create()</code>方法</li>
<li>创建代理对象要求：被代理类不能是最终类</li>
<li><code>create()</code>方法的参数<ul>
<li>Class：指定一个字节码<ul>
<li>用于指定被代理对象的字节码。</li>
</ul>
</li>
<li>InvocationHandler：用于提供增强的代码<ul>
<li>他是让我们写如何代理，我们一般都是写一个该接口的实现类，通常情况下都是匿名内部类但不必须。</li>
<li>我们一般写的都是该接口的子接口实现类，<code>MethodIntercept</code><h2 id="基于接口的动态代理"><a href="#基于接口的动态代理" class="headerlink" title="基于接口的动态代理"></a>基于接口的动态代理</h2></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Producer p = <span class="keyword">new</span> Producer();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 基于接口的动态代理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Iproducer proxyProducer = (Iproducer) Proxy.newProxyInstance(p.getClass().getClassLoader(), p.getClass().getInterfaces(), <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 执行被代理对象的任何接口方法都会经过该方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> proxy 代理对象的引用，一般不用</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method 当前执行的方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> args 当前执行方法所需的参数</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> 和被代理对象有相同返回值</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">//提供增强代码</span></span><br><span class="line">                Object returnValue = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">//1.获取方法执行的参数</span></span><br><span class="line">                Float money = (Float) args[<span class="number">0</span>];</span><br><span class="line">                <span class="comment">//2.判断当前方法是不是销售</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"saleProduct"</span>.equals(method.getName())) &#123;</span><br><span class="line">                    returnValue = method.invoke(p, money * <span class="number">0.8f</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> returnValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        proxyProducer.saleProduct(<span class="number">12000f</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="基于子类的动态代理"><a href="#基于子类的动态代理" class="headerlink" title="基于子类的动态代理"></a>基于子类的动态代理</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Producer p = <span class="keyword">new</span> Producer();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * 基于子类的动态代理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Producer cglibP =(Producer) Enhancer.create(p.getClass(), <span class="keyword">new</span> MethodInterceptor() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 执行被代理对象的方法都会经过该方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> o</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> objects</span></span><br><span class="line"><span class="comment">             * 以上三个参数和基于接口的动态代理中invoke()方法的参数是一样的</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> methodProxy 当前执行方法的代理对象</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                <span class="comment">//提供增强代码</span></span><br><span class="line">                Object returnValue = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">//1.获取方法执行的参数</span></span><br><span class="line">                Float money = (Float) objects[<span class="number">0</span>];</span><br><span class="line">                <span class="comment">//2.判断当前方法是不是销售</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"saleProduct"</span>.equals(method.getName())) &#123;</span><br><span class="line">                    returnValue = method.invoke(p, money * <span class="number">0.8f</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> returnValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cglibP.saleProduct(<span class="number">12000f</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><p>面向切片编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术</p>
<ul>
<li>作用：在程序运行期间，不修改源码对已有方法增强。</li>
<li>优点：<pre><code>减少重复代码
提高开发效率
维护方便</code></pre><h2 id="AOP相关术语"><a href="#AOP相关术语" class="headerlink" title="AOP相关术语"></a>AOP相关术语</h2></li>
<li>JoinPoint：连接点是指那些被拦截到的点。在Spring中，这些点指的是方法，因为Spring只支持方法类型的连接点。</li>
<li>Pointcut：切入点是指我们要对哪些JoinPoint进行拦截的定义。（指被增强的方法）</li>
<li>Advice(通知/增强)：通知就是指拦截到的JoinPoint之后要做的事情。<br>  通知的类型：前置通知，后置通知，异常通知，最终通知，环绕通知。<br><img src="./%E9%80%9A%E7%9F%A5.png" alt="通知"></li>
<li>Introduction(引介)：是一种特殊的通知，在不修改类代码的前提下。Introduction可以在运行期为类动态地添加一些方法和字段。</li>
<li>Target(目标)：代理的目标对象</li>
<li>Weaving(织入)：把增强应用到目标对象来来创建新的代理对象的过程<br>  Spring采用动态代理织入，而Aspectt7采用编译器和类装载期织入。</li>
<li>Proxy：一个类被AOP织入增强后，就产生一个结果代理类</li>
<li>Aspect(切面)：是切入点和通知(引介)的结合</li>
</ul>
<h2 id="Spring基于AOP配置步骤"><a href="#Spring基于AOP配置步骤" class="headerlink" title="Spring基于AOP配置步骤"></a>Spring基于AOP配置步骤</h2><ol>
<li>把通知Bean也交给Spring</li>
<li>使用aop:config标签表明开始AOP配置</li>
<li>使用aop:aspect标签表明配置切面<ul>
<li>id属性：给切面提供一个唯一标识</li>
<li>ref属性：指定通知类bean的id</li>
</ul>
</li>
<li>在aop:aspect内部使用对应标签来配置通知类型<br>//现在的示例是让printLog方法在切入点方法之前执行，是前置通知<ul>
<li>aop:before 表示前置通知<ul>
<li>method属性：用于指定Logger类中哪个方法是前置通知</li>
<li>pointcut属性：用于指定切入点表达式。该表达式含义指的是对业务层哪些方法增强</li>
</ul>
</li>
<li>切入点表达式写法：<ul>
<li>关键字：execution(表达式)</li>
<li>表达式：访问修饰符 返回值 包名.包名.包名….类名.方法名(参数列表)</li>
<li>全通配写法：访问修饰符可以省略，<ul>
<li>返回值可用通配符，</li>
<li>包名可以使用通配符，有几个包就几个*，“..”表示当前包以及子包，</li>
<li>类名可以用通配符，</li>
<li>参数列表可以直接写数据类型<ul>
<li>基本类型直接写名称，</li>
<li>引用类型写包名.类名 java.lang.String</li>
<li>通配符表示任意类型</li>
<li>使用(..)表示有无参数均可，有参数为任意类型<h2 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h2></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>前置通知<br>在切入点方法之前执行</li>
<li>后置通知<br>在切入点方法正常执行之后执行</li>
<li>异常通知<br>在切入点方法执行产生异常后执行</li>
<li>最终通知<br>无论切入点方法是否正常执行，都会在后面执行</li>
</ul>
<blockquote>
<p>后置通知和异常通知只能同时执行一个</p>
</blockquote>
<ul>
<li>old<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    配置Spring的IOC，把Service对象配置进来--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.service.impl.AccountServiceimpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    配置Logger--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"Logger"</span> <span class="attr">class</span>=<span class="string">"com.utils.Logger"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    配置AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        配置切面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"logAdvice"</span> <span class="attr">ref</span>=<span class="string">"Logger"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            配置通知类型，并建立通知方法和切入点方法的关联--&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--            前置通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"beforePrintLog"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">pointcut</span>=<span class="string">"execution(* com.service.impl.*.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--            后置通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterReturnPrintLog"</span></span></span><br><span class="line"><span class="tag">                                 <span class="attr">pointcut</span>=<span class="string">"execution(* com.service.impl.*.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--            异常通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"afterThrowingPrintLog"</span></span></span><br><span class="line"><span class="tag">                                <span class="attr">pointcut</span>=<span class="string">"execution(* com.service.impl.*.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--            后置通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"afterPrintLog"</span></span></span><br><span class="line"><span class="tag">                       <span class="attr">pointcut</span>=<span class="string">"execution(* com.service.impl.*.*(..))"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>new<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--            前置通知 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"beforePrintLog"</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            后置通知--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterReturnPrintLog"</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            异常通知--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"afterThrowingPrintLog"</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            后置通知--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"afterPrintLog"</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">pointcut-ref</span>=<span class="string">"pt1"</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--            配置切入点表达式 id:用于指定表达式唯一标识，expression：表达式内容</span></span><br><span class="line"><span class="comment">                        此标签写在aop:aspect内部只能当前标签使用，写在外部则所有切面可用</span></span><br><span class="line"><span class="comment">                        //注意：约束要求：标签写在aop:aspect外部并写在切面之前而不是之后</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">"pt1"</span> <span class="attr">expression</span>=<span class="string">"execution(* com.service.impl.*.*(..))"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Spring中的环绕通知"><a href="#Spring中的环绕通知" class="headerlink" title="Spring中的环绕通知"></a>Spring中的环绕通知</h3><ul>
<li><p>Spring中的环绕通知<br>他是Spring框架提供的可以在代码中手动控制增强方法何时执行的方式<br>前面的例子是通过配置。下图是通过代码<br><img src="./Spring%E4%B8%AD%E7%9A%84%E7%8E%AF%E7%BB%95%E9%80%9A%E7%9F%A5.png" alt="Spring中的环绕通知"></p>
</li>
<li><p>logger.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 记录日志的工具类，里面提供了公共代码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"Logger"</span>)</span><br><span class="line"><span class="meta">@Aspect</span><span class="comment">//表示当前类是切面类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//切入点</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.service.impl.*.*(..)))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pt1</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"pt1()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforePrintLog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知Logger类中的printLog方法开始记录日志"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturnPrintLog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"后置通知Logger类中的printLog方法开始记录日志"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterThrowing</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowingPrintLog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"异常通知Logger类中的printLog方法开始记录日志"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终通知</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"pt1()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPrintLog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"最终通知Logger类中的printLog方法开始记录日志"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕通知</span></span><br><span class="line"><span class="comment">     * 问题：</span></span><br><span class="line"><span class="comment">     * 当我们配置了环绕通知以后，切入点方法没有执行，而通知方法执行了</span></span><br><span class="line"><span class="comment">     * 分析：</span></span><br><span class="line"><span class="comment">     * 通过对比动态代理中环绕代码，发现动态代理中的环绕通知有明确的切入点方法调用比如invoke。</span></span><br><span class="line"><span class="comment">     * 解决：</span></span><br><span class="line"><span class="comment">     * Spring提供了一个接口：ProceedingJoinPoint，该接口有一个方法，proceed()，此方法相当于明确调用切入点方法。</span></span><br><span class="line"><span class="comment">     * 该接口可以作为环绕通知的方法参数，程序执行时，Spring框架会为我们提供该接口的实现类供我们使用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Spring中的环绕通知</span></span><br><span class="line"><span class="comment">     *      他是Spring框架提供的可以在代码中手动控制增强方法何时执行的方式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"pt1()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  Object <span class="title">aroundPrintLog</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span></span>&#123;</span><br><span class="line">        Object returnValue = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Object args[] = proceedingJoinPoint.getArgs();<span class="comment">//得到方法的参数</span></span><br><span class="line">            System.out.println(<span class="string">"exec aroundPrintLog"</span>);<span class="comment">//前置通知</span></span><br><span class="line"></span><br><span class="line">            returnValue = proceedingJoinPoint.proceed();<span class="comment">//明确调用业务层方法(切入点)</span></span><br><span class="line">            System.out.println(<span class="string">"exec aroundPrintLog"</span>);<span class="comment">//后置通知</span></span><br><span class="line">            <span class="keyword">return</span>  returnValue;</span><br><span class="line">            <span class="comment">//这里不用Exception，拦不住该异常</span></span><br><span class="line">             &#125;<span class="keyword">catch</span> (Throwable t)&#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">"exec aroundPrintLog"</span>);<span class="comment">//异常通知</span></span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"exec aroundPrintLog"</span>);<span class="comment">//最终通知</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> returnValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>bean.xml</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    配置Spring创建容器时要扫描的包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span> &gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    配置Spring开启注解AOP的支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="./%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%90%AFAOP.png" alt="不使用注解开启AOP"></p>
<h1 id="JDBCTemplate"><a href="#JDBCTemplate" class="headerlink" title="JDBCTemplate"></a>JDBCTemplate</h1><p><img src="./%E6%8C%81%E4%B9%85%E5%B1%82%E6%80%BB%E5%9B%BE.png" alt="持久层总图"></p>
<ul>
<li>JDBCTemplate是Spring框架中提供的一个对象，是对原始JDBC API对象的简单封装。Spring框架为我们提供了很多的操作模板类</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">Isabellae</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://is4b3lla3.github.io/2021/03/10/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">http://is4b3lla3.github.io/2021/03/10/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=undefined" async></script><nav id="pagination"><div class="next-post pull-right"><a href="/2021/02/20/Webshell%E5%85%8D%E6%9D%80%E4%B9%8B%E8%9A%81%E5%89%91%E8%BF%9E%E6%8E%A5/"><span>Webshell免杀之蚁剑连接</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'http://is4b3lla3.github.io/2021/03/10/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/';
  this.page.identifier = '2021/03/10/Spring学习笔记/';
  this.page.title = 'Spring学习笔记';
}
var d = document, s = d.createElement('script');
s.src = "https://" + '' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div><footer class="footer-bg" style="background-image: url(/2700d379fda645e77d754fc4956024c6.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2019 - 2021 By Isabellae</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>